#!/usr/bin/env bash

PLATFORM_DIR=$1
CACHE_DIR=$2
LAUNCH_DIR=$3

echo "got into bin/build**********"

# Version 3 Build
# bin/build $stdin=<build plan toml> $stdout=<info logs> $sterr=<warning, error logs>

export BUILDPACK_DIR=`dirname $(readlink -f ${BASH_SOURCE%/*})`
source "$BUILDPACK_DIR/scripts/install_go.sh"
output_dir=$(mktemp -d -t buildXXX)

echo "-----> Building build binary"
GOROOT=$GoInstallDir/go GOPATH=$BUILDPACK_DIR $GoInstallDir/go/bin/go build -o $output_dir/build nodejs/v3/build/cmd

cp "$BUILDPACK_DIR/buildpack.toml" $output_dir

#echo "----- Running build binary"
$output_dir/build "$PLATFORM_DIR" "$CACHE_DIR" "$LAUNCH_DIR"
