#!/bin/bash
set -euo pipefail

BUILD_DIR=$1
CACHE_DIR=$2
DEPS_DIR=$3
DEPS_IDX=$4

export BUILDPACK_DIR=`dirname $(readlink -f ${BASH_SOURCE%/*})`
source "$BUILDPACK_DIR/scripts/install_go.sh"
output_dir=$(mktemp -d -t supplyXXX)

echo "-----> Running go build supply"
GOROOT=$GoInstallDir/go GOPATH=$BUILDPACK_DIR $GoInstallDir/go/bin/go build


# BUILD_DIR: /tmp/app mv -> /home/vcap/app/app/{package.json, etc.}?
# BUILD_DIR: /tmp/app mv -> /home/vcap/app/org.cloudfoundry.buildpacks.nodejs/?
# CACHE_DIR: /tmp/cache/final ?
# DepDir: /tmp/contents262296241/deps/0 ------> /home/vcap/app/org.cloudfoundry.buildpacks.nodejs/
    - What is this? Is it just an empty temp directory?

# Pull in v3 lifecycle repo

# Pull in nodejs-cnb and npm-cnb repo
# Create buildplan.toml??
# In appDir (/home/vcap/app??), call lifecycle/detector with buildpacksDir, launchDir, orderPath, groupPath, planPath
      /lifecycle/detector -buildpacks /buildpacks (nodejs, npm) //Input
                          -order /buildpacks/order.toml //Input
                          -group ./group.toml //Path to where to output
                          -plan ./plan.toml //Path to where to output

      /lifecycle/builder -buildpacks /buildpacks
                         -group ./group.toml
                         -plan ./plan.tom
                         output: /home/vcap/app/org.cloudfoundry.buildpacks.nodejs/launch.toml

# mv /home/vcap/app/org.cloudfoundry.buildpacks.nodejs/* --> /home/vcap/deps/0/org.cloudfoundry.buildpacks.nodejs/*
# In /bin/release, read launch.toml in order to echo start command
